<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SIG | Command Center OS v6.5</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: {
                    sans: ['SF Pro Display', 'Inter', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
                    mono: ['SF Mono', 'JetBrains Mono', 'monospace'],
                },
                extend: {
                    colors: {
                        app: { bg: '#050505', surface: '#121212', border: '#2A2A2A' },
                        sig: {
                            green: '#30D158', greenDim: 'rgba(48, 209, 88, 0.15)',
                            red: '#FF453A',
                            gold: '#FFD60A', goldDim: 'rgba(255, 214, 10, 0.15)',
                            blue: '#0A84FF', blueDim: 'rgba(10, 132, 255, 0.15)',
                            purple: '#BF5AF2',
                            text: '#FFFFFF', mute: '#8E8E93',
                        }
                    },
                    boxShadow: {
                        'glow-green': '0 0 20px rgba(48, 209, 88, 0.15)',
                        'glow-gold': '0 0 20px rgba(255, 214, 10, 0.15)',
                        'glass': '0 8px 32px 0 rgba(0, 0, 0, 0.37)',
                        'glass-hover': '0 12px 40px 0 rgba(0, 0, 0, 0.5)',
                    },
                    animation: {
                        'pop-in': 'popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)',
                        'slide-in': 'slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                    },
                    keyframes: {
                        popIn: { '0%': { opacity: '0', transform: 'scale(0.95)' }, '100%': { opacity: '1', transform: 'scale(1)' } },
                        slideIn: { '0%': { transform: 'translateX(20px)', opacity: '0' }, '100%': { transform: 'translateX(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar for the page but keeping it hidden for cleanliness where preferred */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Glass Panel Polish */
        .glass-panel {
            background: rgba(28, 28, 30, 0.65);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }

        /* Interactive Hover Effect for cards */
        .glass-panel:hover {
            border-color: rgba(255, 255, 255, 0.15);
        }

        .glass-panel-light {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
        }

        .view-section {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .view-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .apple-table-row {
            transition: background-color 0.2s ease;
        }

        .apple-table-row:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        /* Mobile Table Fix */
        .table-scroll-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .table-min-width {
            min-width: 800px;
            /* Forces scroll on mobile instead of crushing columns */
        }

        .filter-btn.active,
        .fba-filter-btn.active,
        .trading-filter-btn.active {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Timeline Styles */
        .timeline-track {
            position: relative;
            height: 4px;
            background: #333;
            border-radius: 2px;
            width: 100%;
            margin: 20px 0;
        }

        .timeline-fill {
            position: absolute;
            height: 100%;
            background: #30D158;
            border-radius: 2px;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .timeline-dot {
            position: absolute;
            top: -6px;
            width: 14px;
            height: 14px;
            background: #121212;
            border: 2px solid #555;
            border-radius: 50%;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .timeline-dot.active {
            border-color: #30D158;
            background: #30D158;
            box-shadow: 0 0 10px rgba(48, 209, 88, 0.5);
        }

        /* Chart Styles */
        .pie-chart {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .pie-chart::after {
            content: "--";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(28, 28, 30, 0.95);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6B7280;
            font-size: 14px;
            font-weight: bold;
        }

        .gender-donut {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .gender-donut::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90px;
            height: 90px;
            background: rgba(28, 28, 30, 1);
            border-radius: 50%;
        }

        .bar-container {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 6px;
        }

        .bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-out;
        }
    </style>
</head>

<body
    class="bg-app-bg text-sig-text antialiased min-h-screen flex selection:bg-sig-green selection:text-black font-sans overflow-hidden">

    <div id="loginScreen" class="fixed inset-0 z-[100] bg-app-bg flex items-center justify-center">
        <div class="glass-panel p-10 rounded-3xl w-full max-w-md mx-4 text-center shadow-2xl">
            <div class="flex justify-center mb-8">
                <div
                    class="w-20 h-20 rounded-2xl bg-sig-green flex items-center justify-center font-bold text-black text-3xl shadow-glow-green">
                    S
                </div>
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">SIG Command Center</h1>
            <p class="text-sig-mute text-sm mb-8">Admin Access Only</p>

            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div class="text-left">
                    <label class="text-xs text-gray-400 uppercase tracking-wider mb-2 block">Email</label>
                    <input type="email" id="loginEmail" placeholder="admin@sig.com" required
                        class="w-full px-4 py-3 rounded-xl bg-black/50 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-sig-green/50 transition-colors">
                </div>
                <div class="text-left">
                    <label class="text-xs text-gray-400 uppercase tracking-wider mb-2 block">Password</label>
                    <input type="password" id="loginPassword" placeholder="••••••••" required
                        class="w-full px-4 py-3 rounded-xl bg-black/50 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-sig-green/50 transition-colors">
                </div>
                <div id="loginError" class="text-red-400 text-sm hidden">Invalid credentials. Please try again.</div>
                <button type="submit"
                    class="w-full bg-sig-green text-black font-bold py-3 px-6 rounded-xl hover:bg-green-400 transition-colors shadow-lg shadow-sig-green/20 mt-2">
                    Sign In
                </button>
            </form>

            <p class="text-gray-600 text-xs mt-8">Protected by Shariah Investments Global</p>
        </div>
    </div>

    <div id="mainApp" class="hidden w-full h-full flex">

        <div id="mobileMenu"
            class="fixed inset-0 z-[60] bg-black/95 backdrop-blur-xl hidden flex-col items-center justify-center space-y-8 animate-pop-in md:hidden">
            <button onclick="toggleMobileMenu()" class="absolute top-6 right-6 p-2 text-gray-400 hover:text-white"><i
                    data-lucide="x" class="w-8 h-8"></i></button>
            <div class="flex items-center gap-3 mb-8">
                <div
                    class="w-12 h-12 rounded-xl bg-sig-green flex items-center justify-center font-bold text-black text-xl shadow-glow-green">
                    S</div>
                <span class="font-bold text-2xl tracking-tight text-white">SIG OS</span>
            </div>
            <button onclick="switchView('dashboard'); toggleMobileMenu()"
                class="text-xl font-medium text-white hover:text-sig-green transition-colors">Command Center</button>
            <button onclick="switchView('sourcing'); toggleMobileMenu()"
                class="text-xl font-medium text-gray-400 hover:text-white transition-colors">Sourcing Vault</button>
            <button onclick="switchView('fba'); toggleMobileMenu()"
                class="text-xl font-medium text-gray-400 hover:text-white transition-colors">FBA Masterclass</button>
            <button onclick="switchView('trading'); toggleMobileMenu()"
                class="text-xl font-medium text-gray-400 hover:text-white transition-colors">Trading Floor</button>
            <button onclick="switchView('hudood'); toggleMobileMenu()"
                class="text-xl font-medium text-gray-400 hover:text-white transition-colors">Hudood Query</button>
            <button onclick="switchView('demographics'); toggleMobileMenu()"
                class="text-xl font-medium text-gray-400 hover:text-white transition-colors">Demographics</button>
        </div>

        <aside
            class="hidden md:flex flex-col w-[280px] h-screen fixed left-0 top-0 border-r border-app-border bg-black/50 backdrop-blur-xl z-50 pt-8 pb-6 px-4">
            <div class="px-2 mb-10 flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-xl bg-gradient-to-b from-sig-green to-emerald-800 flex items-center justify-center shadow-glow-green">
                    <span class="font-bold text-black text-lg">S</span>
                </div>
                <div>
                    <h1 class="font-bold text-lg tracking-tight">SIG</h1>
                    <div class="flex items-center gap-1.5" id="connectionStatus">
                        <span class="w-1.5 h-1.5 rounded-full bg-gray-500" id="statusDot"></span>
                        <span class="text-[10px] text-sig-mute uppercase font-semibold tracking-wider"
                            id="statusText">Checking...</span>
                    </div>
                </div>
            </div>

            <nav class="flex-1 space-y-2">
                <div class="px-2 text-[10px] font-semibold text-gray-600 uppercase tracking-widest mb-3">Platform</div>
                <button onclick="switchView('dashboard')" id="nav-dashboard"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all text-white bg-white/10 shadow-inner border border-white/5"><i
                        data-lucide="layout-grid" class="w-4 h-4 text-sig-green"></i> Command Center</button>
                <button onclick="switchView('demographics')" id="nav-demographics"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all"><i
                        data-lucide="users" class="w-4 h-4"></i> Demographics</button>

                <div class="px-2 text-[10px] font-semibold text-gray-600 uppercase tracking-widest mb-3 mt-8">Funnels
                </div>
                <button onclick="switchView('sourcing')" id="nav-sourcing"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all"><i
                        data-lucide="package" class="w-4 h-4"></i> Path A: Sourcing</button>
                <button onclick="switchView('fba')" id="nav-fba"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all"><i
                        data-lucide="layers" class="w-4 h-4"></i> Path B: FBA Brand</button>
                <button onclick="switchView('trading')" id="nav-trading"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all"><i
                        data-lucide="bar-chart-2" class="w-4 h-4"></i> Path C: Trading</button>

                <div class="px-2 text-[10px] font-semibold text-gray-600 uppercase tracking-widest mb-3 mt-8">Tools
                </div>
                <button onclick="switchView('hudood')" id="nav-hudood"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all"><i
                        data-lucide="shield-check" class="w-4 h-4 text-sig-purple"></i> Path D: Hudood</button>
                <button onclick="openCalculator()"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-400 hover:text-white hover:bg-white/5 transition-all"><i
                        data-lucide="calculator" class="w-4 h-4 text-orange-400"></i> Landed Cost Calc</button>
            </nav>

            <div class="mt-auto pt-6 border-t border-app-border">
                <div
                    class="flex items-center gap-3 px-2 py-2 rounded-xl hover:bg-white/5 cursor-pointer transition-colors">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Admin"
                        class="w-9 h-9 rounded-full bg-gray-800 border border-gray-700">
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-white truncate">Lead Consultant</p>
                        <p class="text-xs text-gray-500 truncate">admin@sig-global.com</p>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 md:ml-[280px] h-screen overflow-y-auto scroll-smooth relative">
            <div
                class="fixed top-0 left-0 w-full h-[500px] bg-gradient-to-b from-sig-greenDim to-transparent opacity-20 pointer-events-none z-0">
            </div>

            <div class="relative z-10 p-6 md:p-10 max-w-7xl mx-auto pb-32">

                <div class="md:hidden flex justify-between items-center mb-8">
                    <div class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-lg bg-sig-green flex items-center justify-center font-bold text-black">
                            S
                        </div>
                        <span class="font-bold text-lg">SIG</span>
                    </div>
                    <button onclick="toggleMobileMenu()" class="p-2 bg-white/10 rounded-full text-white"><i
                            data-lucide="menu" class="w-5 h-5"></i></button>
                </div>

                <div id="view-dashboard" class="view-section active">
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-10">
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">Command Center</h2>
                            <p class="text-sig-mute text-sm md:text-base">Real-time triage and capital allocation
                                metrics.
                            </p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="exportData()"
                                class="glass-panel-light hover:bg-white/10 text-white px-5 py-2.5 rounded-full text-sm font-medium transition-all flex items-center gap-2">
                                <i data-lucide="download" class="w-4 h-4 text-gray-400"></i> Export
                            </button>
                            <button onclick="openAddLeadModal()"
                                class="bg-sig-text text-black hover:bg-gray-200 px-5 py-2.5 rounded-full text-sm font-bold transition-all shadow-lg flex items-center gap-2">
                                <i data-lucide="plus" class="w-4 h-4"></i> Add Lead
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                        <div class="glass-panel p-6 rounded-3xl relative overflow-hidden group">
                            <div class="flex justify-between items-start mb-8">
                                <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center"><i
                                        data-lucide="book" class="w-5 h-5 text-blue-400"></i></div><span
                                    class="text-xs font-bold text-blue-400 bg-blue-500/10 px-2 py-1 rounded-full">+18%</span>
                            </div>
                            <div class="text-3xl font-bold text-white mb-1">0</div>
                            <div class="text-xs text-sig-mute uppercase tracking-wider font-semibold">Active Book Leads
                            </div>
                        </div>
                        <div class="glass-panel p-6 rounded-3xl relative overflow-hidden group">
                            <div class="flex justify-between items-start mb-8">
                                <div class="w-10 h-10 rounded-full bg-sig-greenDim flex items-center justify-center"><i
                                        data-lucide="package" class="w-5 h-5 text-sig-green"></i></div>
                            </div>
                            <div class="text-3xl font-bold text-white mb-1">0</div>
                            <div class="text-xs text-sig-mute uppercase tracking-wider font-semibold">Active Sourcing
                                Leads
                            </div>
                        </div>
                        <div class="glass-panel p-6 rounded-3xl relative overflow-hidden group">
                            <div class="flex justify-between items-start mb-8">
                                <div class="w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center"><i
                                        data-lucide="layers" class="w-5 h-5 text-orange-400"></i></div><span
                                    class="text-xs font-bold text-orange-400 bg-orange-500/10 px-2 py-1 rounded-full">VIP</span>
                            </div>
                            <div class="text-3xl font-bold text-white mb-1">0</div>
                            <div class="text-xs text-sig-mute uppercase tracking-wider font-semibold">Active FBA Leads
                            </div>
                        </div>
                        <div class="glass-panel p-6 rounded-3xl relative overflow-hidden group">
                            <div class="flex justify-between items-start mb-8">
                                <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center"><i
                                        data-lucide="bar-chart-2" class="w-5 h-5 text-blue-500"></i></div>
                            </div>
                            <div class="text-3xl font-bold text-white mb-1">0</div>
                            <div class="text-xs text-sig-mute uppercase tracking-wider font-semibold">Active Trading
                                Leads
                            </div>
                        </div>
                    </div>

                    <div
                        class="glass-panel p-6 rounded-3xl border border-sig-red/30 bg-sig-red/5 mb-10 relative overflow-hidden shadow-[0_0_20px_rgba(255,69,58,0.15)]">
                        <div
                            class="absolute top-0 right-0 w-32 h-32 bg-sig-red/10 rounded-bl-full -mr-8 -mt-8 blur-2xl">
                        </div>
                        <div class="flex justify-between items-center mb-4 relative z-10">
                            <h3 class="text-lg font-bold text-white flex items-center gap-2"><i
                                    data-lucide="alert-triangle" class="w-5 h-5 text-sig-red"></i> Action Required <span
                                    class="px-2 py-0.5 rounded-full bg-sig-red/20 text-sig-red text-[10px] font-bold border border-sig-red/20">0
                                    Pending</span></h3>
                            <button class="text-xs text-gray-400 hover:text-white flex items-center gap-1">View All <i
                                    data-lucide="chevron-right" class="w-3 h-3"></i></button>
                        </div>
                        <div class="space-y-3 relative z-10">
                            <div class="text-center text-gray-500 py-4 text-xs italic">No pending actions</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">
                        <div class="glass-panel p-6 rounded-3xl col-span-1 flex flex-col justify-between">
                            <h3 class="text-base font-bold flex items-center gap-2 mb-6"><i data-lucide="pie-chart"
                                    class="w-4 h-4 text-sig-green"></i> Sourcing Mix</h3>
                            <div class="text-center text-gray-500 py-8 text-sm italic">No sourcing data yet</div>
                        </div>
                        <div
                            class="glass-panel p-6 rounded-3xl col-span-1 lg:col-span-2 flex flex-col md:flex-row items-center justify-around gap-6">
                            <div class="flex-1 w-full">
                                <h3 class="text-base font-bold flex items-center gap-2 mb-6"><i data-lucide="activity"
                                        class="w-4 h-4 text-blue-400"></i> Query Distribution</h3>
                                <div class="text-center text-gray-500 py-4 text-sm italic">No query data yet</div>
                            </div>
                            <div class="flex flex-col items-center justify-center p-4">
                                <div class="pie-chart shadow-2xl"></div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-panel rounded-3xl overflow-hidden shadow-glass">
                        <div
                            class="p-5 border-b border-white/5 flex flex-col md:flex-row justify-between items-center gap-4">
                            <h3 class="font-semibold text-lg text-white">Lead Intelligence</h3>
                            <div class="flex gap-1 w-full md:w-auto bg-black p-1 rounded-xl border border-white/10">
                                <button onclick="filterTable('all', this)"
                                    class="filter-btn active flex-1 px-5 py-1.5 rounded-lg text-xs font-medium transition-all">All</button>
                                <button onclick="filterTable('VIP', this)"
                                    class="filter-btn inactive flex-1 px-5 py-1.5 rounded-lg text-xs font-medium transition-all">VIP</button>
                                <button onclick="filterTable('HighIntent', this)"
                                    class="filter-btn inactive flex-1 px-5 py-1.5 rounded-lg text-xs font-medium transition-all">High
                                    Intent</button>
                                <button onclick="filterTable('LowBudget', this)"
                                    class="filter-btn inactive flex-1 px-5 py-1.5 rounded-lg text-xs font-medium transition-all">Low
                                    Budget</button>
                            </div>
                        </div>
                        <div class="table-scroll-container">
                            <div class="table-min-width">
                                <div
                                    class="grid grid-cols-12 px-6 py-3 bg-white/5 border-b border-white/5 text-[10px] font-bold text-sig-mute uppercase tracking-wider">
                                    <div class="col-span-4">Profile & Location</div>
                                    <div class="col-span-2">Designated Path</div>
                                    <div class="col-span-2 text-center">Score</div>
                                    <div class="col-span-2 text-right">Budget</div>
                                    <div class="col-span-2 text-right">Action</div>
                                </div>
                                <div id="leadsList" class="divide-y divide-white/5"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-sourcing" class="view-section">
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-10">
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">Sourcing Vault</h2>
                            <p class="text-sig-mute text-sm md:text-base">Manage imports, factory negotiations, and
                                logistics.</p>
                        </div>
                        <div class="flex items-center gap-3"><button onclick="openCalculator()"
                                class="glass-panel-light hover:bg-white/10 text-white px-5 py-2.5 rounded-full text-sm font-medium transition-all flex items-center gap-2"><i
                                    data-lucide="calculator" class="w-4 h-4 text-orange-400"></i> Cost
                                Calc</button><button onclick="openInquiryModal()"
                                class="bg-sig-green text-black hover:bg-green-400 px-5 py-2.5 rounded-full text-sm font-bold transition-all shadow-lg flex items-center gap-2"><i
                                    data-lucide="plus" class="w-4 h-4"></i> Add Inquiry</button></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400">
                                <i data-lucide="search" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">New Inquiries</div>
                            </div>
                        </div>
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-orange-500/10 flex items-center justify-center text-orange-400">
                                <i data-lucide="alert-circle" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Pending Fee (₹1,999)
                                </div>
                            </div>
                        </div>
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-sig-green/10 flex items-center justify-center text-sig-green">
                                <i data-lucide="factory" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Factory Search</div>
                            </div>
                        </div>
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400">
                                <i data-lucide="file-check" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Reports Ready</div>
                            </div>
                        </div>
                    </div>
                    <div class="glass-panel rounded-3xl overflow-hidden shadow-glass">
                        <div class="p-5 border-b border-white/5 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <h3 class="font-semibold text-lg text-white">Active Requests</h3><span
                                    class="text-xs text-gray-500">Path A Exclusive</span>
                            </div><button class="text-xs text-blue-400 hover:text-white flex items-center gap-1"><i
                                    data-lucide="external-link" class="w-3 h-3"></i> View Broadcast Vault</button>
                        </div>
                        <div class="table-scroll-container">
                            <div class="table-min-width">
                                <div
                                    class="grid grid-cols-12 px-6 py-3 bg-white/5 border-b border-white/5 text-[10px] font-bold text-sig-mute uppercase tracking-wider">
                                    <div class="col-span-3">Client & Product</div>
                                    <div class="col-span-2">Type</div>
                                    <div class="col-span-2">Stage</div>
                                    <div class="col-span-2 text-right">Target Price</div>
                                    <div class="col-span-3 text-right">Actions</div>
                                </div>
                                <div class="divide-y divide-white/5">
                                    <div class="text-center text-gray-500 py-8 text-sm">No active requests found</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-fba" class="view-section">
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-10">
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">FBA Masterclass</h2>
                            <p class="text-sig-mute text-sm md:text-base">Brand building pipeline & student progress.
                            </p>
                        </div>
                        <div class="flex items-center gap-3"><button onclick="openFbaCalc()"
                                class="glass-panel-light hover:bg-white/10 text-white px-5 py-2.5 rounded-full text-sm font-medium transition-all flex items-center gap-2"><i
                                    data-lucide="calculator" class="w-4 h-4 text-sig-gold"></i> FBA Calc</button><button
                                onclick="openAddLeadModal()"
                                class="bg-sig-gold text-black hover:bg-yellow-400 px-5 py-2.5 rounded-full text-sm font-bold transition-all shadow-lg flex items-center gap-2"><i
                                    data-lucide="plus" class="w-4 h-4"></i> Enroll Student</button></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400">
                                <i data-lucide="help-circle" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">FBA Mentorship Enquiries
                                </div>
                            </div>
                        </div>
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-sig-gold/10 flex items-center justify-center text-sig-gold">
                                <i data-lucide="crown" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Qualified VIPs (>8L)
                                </div>
                            </div>
                        </div>
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-sig-green/10 flex items-center justify-center text-sig-green">
                                <i data-lucide="check-circle" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Enrolled Students</div>
                            </div>
                        </div>
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-orange-500/10 flex items-center justify-center text-orange-400">
                                <i data-lucide="clock" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Pending Payment</div>
                            </div>
                        </div>
                    </div>
                    <div class="glass-panel rounded-3xl overflow-hidden shadow-glass">
                        <div
                            class="p-5 border-b border-white/5 flex flex-col md:flex-row justify-between items-center gap-4">
                            <h3 class="font-semibold text-lg text-white">FBA Leads</h3>
                            <div class="flex gap-1 w-full md:w-auto bg-black p-1 rounded-xl border border-white/10">
                                <button onclick="renderFbaLeads('All')"
                                    class="fba-filter-btn active flex-1 px-5 py-1.5 rounded-lg text-xs font-medium text-gray-400 hover:text-white transition-all">All</button><button
                                    onclick="renderFbaLeads('VIP')"
                                    class="fba-filter-btn flex-1 px-5 py-1.5 rounded-lg text-xs font-medium text-gray-400 hover:text-white transition-all">VIP
                                    (8L+)</button><button onclick="renderFbaLeads('Enrolled')"
                                    class="fba-filter-btn flex-1 px-5 py-1.5 rounded-lg text-xs font-medium text-gray-400 hover:text-white transition-all">Students</button><button
                                    onclick="renderFbaLeads('LowCap')"
                                    class="fba-filter-btn flex-1 px-5 py-1.5 rounded-lg text-xs font-medium text-gray-400 hover:text-white transition-all">Low
                                    Cap</button>
                            </div>
                        </div>
                        <div class="table-scroll-container">
                            <div class="table-min-width">
                                <div
                                    class="grid grid-cols-12 px-6 py-3 bg-white/5 border-b border-white/5 text-[10px] font-bold text-sig-mute uppercase tracking-wider">
                                    <div class="col-span-4">Profile & Intent</div>
                                    <div class="col-span-3">Qualification</div>
                                    <div class="col-span-2 text-right">Capital</div>
                                    <div class="col-span-3 text-right">Action</div>
                                </div>
                                <div id="fbaLeadsList" class="divide-y divide-white/5"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-trading" class="view-section">
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-10">
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">Halal Trading</h2>
                            <p class="text-sig-mute text-sm md:text-base">Technical analysis, mentorship, and passive
                                income
                                strategies.</p>
                        </div>
                        <div class="flex items-center gap-3"><button onclick="openAddLeadModal()"
                                class="bg-sig-green text-black hover:bg-green-400 px-5 py-2.5 rounded-full text-sm font-bold transition-all shadow-lg flex items-center gap-2"><i
                                    data-lucide="plus" class="w-4 h-4"></i> Add Student</button></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400">
                                <i data-lucide="users" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Mentorship Enquiries
                                </div>
                            </div>
                        </div>
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400">
                                <i data-lucide="book-open" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Trader's Guide Enquiries
                                </div>
                            </div>
                        </div>
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-sig-green/10 flex items-center justify-center text-sig-green">
                                <i data-lucide="check-circle" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Enrolled Students</div>
                            </div>
                        </div>
                        <div
                            class="glass-panel p-5 rounded-2xl flex items-center gap-4 hover:translate-y-[-2px] transition-transform">
                            <div
                                class="w-12 h-12 rounded-xl bg-orange-500/10 flex items-center justify-center text-orange-400">
                                <i data-lucide="clock" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-white">0</div>
                                <div class="text-[10px] text-gray-400 uppercase tracking-wider">Pending Payment</div>
                            </div>
                        </div>
                    </div>
                    <div class="glass-panel rounded-3xl overflow-hidden shadow-glass">
                        <div
                            class="p-5 border-b border-white/5 flex flex-col md:flex-row justify-between items-center gap-4">
                            <h3 class="font-semibold text-lg text-white">Trading Leads</h3>
                            <div class="flex gap-1 w-full md:w-auto bg-black p-1 rounded-xl border border-white/10">
                                <button onclick="renderTradingLeads('All')"
                                    class="trading-filter-btn active flex-1 px-5 py-1.5 rounded-lg text-xs font-medium text-gray-400 hover:text-white transition-all">All</button>
                                <button onclick="renderTradingLeads('Mentorship')"
                                    class="trading-filter-btn flex-1 px-5 py-1.5 rounded-lg text-xs font-medium text-gray-400 hover:text-white transition-all">Mentorship
                                    (VIP)</button>
                                <button onclick="renderTradingLeads('Guidebook')"
                                    class="trading-filter-btn flex-1 px-5 py-1.5 rounded-lg text-xs font-medium text-gray-400 hover:text-white transition-all">Guidebook</button>
                                <button onclick="renderTradingLeads('General')"
                                    class="trading-filter-btn flex-1 px-5 py-1.5 rounded-lg text-xs font-medium text-gray-400 hover:text-white transition-all">General</button>
                                <button onclick="renderTradingLeads('Students')"
                                    class="trading-filter-btn flex-1 px-5 py-1.5 rounded-lg text-xs font-medium text-gray-400 hover:text-white transition-all">Students</button>
                            </div>
                        </div>
                        <div class="table-scroll-container">
                            <div class="table-min-width">
                                <div
                                    class="grid grid-cols-12 px-6 py-3 bg-white/5 border-b border-white/5 text-[10px] font-bold text-sig-mute uppercase tracking-wider">
                                    <div class="col-span-4">Lead Profile</div>
                                    <div class="col-span-3">Interest Type</div>
                                    <div class="col-span-2">Experience</div>
                                    <div class="col-span-3 text-right">Action</div>
                                </div>
                                <div id="tradingLeadsList" class="divide-y divide-white/5"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-demographics" class="view-section">
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-10">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2">Audience Demographics</h2>
                            <p class="text-sig-mute text-sm">Interactive Deep-dive intelligence.</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="loadDemographics()"
                                class="glass-panel-light hover:bg-white/10 text-white px-5 py-2.5 rounded-full text-sm font-medium transition-all flex items-center gap-2">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i> Refresh
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
                        <div onclick="openDemoDetail('age')"
                            class="glass-panel p-6 rounded-3xl cursor-pointer hover:bg-white/5 transition-colors group">
                            <h3 class="text-sm font-bold text-white flex items-center gap-2 mb-6"><i data-lucide="user"
                                    class="w-4 h-4 text-sig-green"></i> Age Distribution</h3>
                            <div class="space-y-4" id="demoAgeList">
                                <div class="text-center text-gray-500 py-4 text-xs italic">No data available</div>
                            </div>
                        </div>

                        <div onclick="openDemoDetail('gender')"
                            class="glass-panel p-6 rounded-3xl flex flex-col items-center justify-center cursor-pointer hover:bg-white/5 transition-colors group">
                            <h3 class="text-sm font-bold text-white w-full text-left mb-2 flex gap-2"><i
                                    data-lucide="users" class="w-4 h-4 text-blue-400"></i> Gender</h3>
                            <div class="gender-donut flex items-center justify-center mb-6 relative">
                                <svg width="120" height="120" viewBox="0 0 42 42" class="donut">
                                    <circle class="donut-hole" cx="21" cy="21" r="15.91549430918954" fill="transparent">
                                    </circle>
                                    <circle class="donut-ring" cx="21" cy="21" r="15.91549430918954" fill="transparent"
                                        stroke="rgba(255,255,255,0.1)" stroke-width="5"></circle>
                                    <circle id="genderDonutSegment" class="donut-segment" cx="21" cy="21"
                                        r="15.91549430918954" fill="transparent" stroke="#3b82f6" stroke-width="5"
                                        stroke-dasharray="0 100" stroke-dashoffset="25"></circle>
                                </svg>
                                <div
                                    class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                    <span class="text-2xl font-bold text-white" id="genderMainPercent">0%</span>
                                    <span class="text-[8px] text-gray-500 uppercase tracking-widest">MALE</span>
                                </div>
                            </div>
                            <div class="flex gap-6" id="genderLegend">
                                <div class="text-xs text-gray-500">No data</div>
                            </div>
                        </div>

                        <div onclick="openDemoDetail('occupation')"
                            class="glass-panel p-6 rounded-3xl cursor-pointer hover:bg-white/5 transition-colors group">
                            <h3 class="text-sm font-bold text-white flex items-center gap-2 mb-6"><i
                                    data-lucide="briefcase" class="w-4 h-4 text-purple-400"></i> Occupation</h3>
                            <div class="space-y-4" id="demoOccList">
                                <div class="text-center text-gray-500 py-4 text-xs italic">No data available</div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2"><i data-lucide="map-pin"
                                class="w-5 h-5 text-orange-400"></i> Global Footprint Intelligence</h3>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-6" id="demoLocationGrid">
                            <div class="col-span-full text-center text-gray-500 py-8 text-sm italic">No location data
                                mapped
                                yet
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-demographics-details" class="view-section">
                    <div class="flex items-center gap-4 mb-8"><button onclick="switchView('demographics')"
                            class="p-2 rounded-full bg-white/5 hover:bg-white/10 transition-colors"><i
                                data-lucide="arrow-left" class="w-5 h-5 text-gray-400"></i></button>
                        <div>
                            <h2 class="text-3xl font-bold text-white" id="demoDetailTitle">Details</h2>
                            <p class="text-sig-mute text-sm">Filtered User List</p>
                        </div>
                    </div>
                    <div class="glass-panel rounded-3xl overflow-hidden shadow-glass">
                        <div class="p-5 border-b border-white/5 flex flex-wrap gap-2" id="demoFilters"></div>
                        <div class="table-scroll-container">
                            <div class="table-min-width">
                                <div
                                    class="grid grid-cols-12 px-6 py-3 bg-white/5 border-b border-white/5 text-[10px] font-bold text-sig-mute uppercase tracking-wider">
                                    <div class="col-span-4">User Profile</div>
                                    <div class="col-span-2">Gender</div>
                                    <div class="col-span-2">Age</div>
                                    <div class="col-span-2">Occupation</div>
                                    <div class="col-span-2 text-right">Budget</div>
                                </div>
                                <div id="demoLeadsList" class="divide-y divide-white/5"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-hudood" class="view-section h-96 flex items-center justify-center text-center">
                    <div class="w-full max-w-5xl mx-auto px-6">
                        <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-10">
                            <div>
                                <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">Path D: Hudood</h2>
                                <p class="text-sig-mute text-sm md:text-base">Log of Shariah compliance queries. Users
                                    are
                                    redirected to the official Hudood channel.</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <div
                                    class="px-4 py-2 rounded-xl bg-purple-500/10 border border-purple-500/20 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-sig-purple animate-pulse"></span>
                                    <span class="text-xs font-bold text-sig-purple">Auto-Redirect Active</span>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                            <div class="glass-panel p-5 rounded-2xl flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400">
                                    <i data-lucide="message-circle" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-white">0</div>
                                    <div class="text-[10px] text-gray-400 uppercase tracking-wider">Total Inquiries
                                    </div>
                                </div>
                            </div>
                            <div class="glass-panel p-5 rounded-2xl flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-sig-green/10 flex items-center justify-center text-sig-green">
                                    <i data-lucide="corner-up-right" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-white">0</div>
                                    <div class="text-[10px] text-gray-400 uppercase tracking-wider">Redirected</div>
                                </div>
                            </div>
                            <div class="glass-panel p-5 rounded-2xl flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-orange-500/10 flex items-center justify-center text-orange-400">
                                    <i data-lucide="clock" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-white">0</div>
                                    <div class="text-[10px] text-gray-400 uppercase tracking-wider">Pending Action</div>
                                </div>
                            </div>
                        </div>
                        <div class="glass-panel rounded-3xl overflow-hidden shadow-glass">
                            <div class="p-5 border-b border-white/5">
                                <h3 class="font-semibold text-lg text-white">Recent Queries</h3>
                            </div>
                            <div class="table-scroll-container">
                                <div class="table-min-width">
                                    <div
                                        class="grid grid-cols-12 px-6 py-3 bg-white/5 border-b border-white/5 text-[10px] font-bold text-sig-mute uppercase tracking-wider">
                                        <div class="col-span-4">User & Query</div>
                                        <div class="col-span-3">Topic</div>
                                        <div class="col-span-3">Status</div>
                                        <div class="col-span-2 text-right"></div>
                                    </div>
                                    <div id="hudoodList" class="divide-y divide-white/5"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>

        <div id="inquiryModal" class="fixed inset-0 z-[130] hidden" role="dialog">
            <div class="fixed inset-0 bg-black/80 backdrop-blur-sm" onclick="closeInquiryModal()"></div>
            <div class="fixed inset-0 flex items-center justify-center p-4">
                <div
                    class="bg-[#1c1c1e] border border-white/10 p-8 rounded-3xl w-full max-w-md animate-pop-in relative shadow-2xl">
                    <div class="absolute top-4 right-4 z-50">
                        <button onclick="closeInquiryModal()"
                            class="p-2 rounded-full bg-white/10 hover:bg-white/20 text-gray-400 hover:text-white transition-all"><i
                                data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-white">Log New Sourcing Inquiry</h3>
                    </div>
                    <div class="space-y-4">
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Client Name</label><input
                                type="text"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1 focus:border-sig-green/50 outline-none">
                        </div>
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Product Category</label><input
                                type="text"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1 focus:border-sig-green/50 outline-none">
                        </div>
                        <div>
                            <label class="text-xs text-gray-500 uppercase font-bold">Request Type</label>
                            <div class="flex gap-2 mt-1">
                                <button
                                    onclick="this.classList.toggle('border-blue-500'); this.classList.toggle('text-blue-400')"
                                    class="flex-1 py-2 rounded-xl bg-black/40 border border-white/10 text-xs font-bold text-gray-400 transition-colors hover:bg-white/5">Broadcast
                                    Deal</button>
                                <button
                                    onclick="this.classList.toggle('border-purple-500'); this.classList.toggle('text-purple-400')"
                                    class="flex-1 py-2 rounded-xl bg-black/40 border border-white/10 text-xs font-bold text-gray-400 transition-colors hover:bg-white/5">Custom
                                    Search</button>
                            </div>
                            <p class="text-[10px] text-gray-500 mt-1 italic">*Custom Search triggers ₹1,999 Fee Protocol
                            </p>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-red-500/10 border border-red-500/20 rounded-xl">
                            <input type="checkbox" id="replicaCheck" class="w-4 h-4 rounded bg-black border-red-500/50">
                            <label for="replicaCheck" class="text-xs text-red-300 font-medium">Compliance: Confirmed NOT
                                a
                                Replica/Fake</label>
                        </div>
                        <button onclick="closeInquiryModal(); alert('Inquiry Logged. Sourcing Experts Notified.');"
                            class="w-full bg-sig-green text-black font-bold py-3 rounded-xl mt-2 hover:bg-green-400 transition-colors">Add
                            Inquiry</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="addLeadModal" class="fixed inset-0 z-[140] hidden" role="dialog">
            <div class="fixed inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAddLeadModal()"></div>
            <div class="fixed inset-0 flex items-center justify-center p-4">
                <div
                    class="bg-[#1c1c1e] border border-white/10 p-8 rounded-3xl w-full max-w-md animate-pop-in relative shadow-2xl">
                    <div class="absolute top-4 right-4 z-50">
                        <button onclick="closeAddLeadModal()"
                            class="p-2 rounded-full bg-white/10 hover:bg-white/20 text-gray-400 hover:text-white transition-all"><i
                                data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-white">Add New Lead</h3>
                    </div>
                    <div class="space-y-4">
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Name</label><input type="text"
                                id="newLeadName"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1 outline-none focus:border-sig-green/50">
                        </div>
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Location</label><input type="text"
                                id="newLeadLoc"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1 outline-none focus:border-sig-green/50">
                        </div>
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Contact Number</label><input
                                type="text" id="newLeadPhone" placeholder="+91..."
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1 outline-none focus:border-sig-green/50">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="text-xs text-gray-500 uppercase font-bold">Budget (INR)</label><input
                                    type="number" id="newLeadBudget"
                                    class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1 outline-none focus:border-sig-green/50">
                            </div>
                            <div>
                                <label class="text-xs text-gray-500 uppercase font-bold">Path</label>
                                <select id="newLeadPath"
                                    class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1 outline-none focus:border-sig-green/50">
                                    <option value="Path A">Sourcing</option>
                                    <option value="Path B">FBA Brand</option>
                                    <option value="Path C">Trading</option>
                                </select>
                            </div>
                        </div>
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Interest/Niche</label><input
                                type="text" id="newLeadNiche"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1 outline-none focus:border-sig-green/50">
                        </div>
                        <button onclick="saveNewLead()"
                            class="w-full bg-sig-green text-black font-bold py-3 rounded-xl mt-4 hover:bg-green-400 transition-colors">Save
                            to Database</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="reportModal" class="fixed inset-0 z-[120] hidden" role="dialog">
            <div class="fixed inset-0 bg-black/80 backdrop-blur-sm" onclick="closeReportModal()"></div>
            <div class="fixed inset-0 flex items-center justify-center p-4">
                <div
                    class="bg-[#1c1c1e] border border-white/10 p-8 rounded-3xl w-full max-w-md animate-pop-in relative">
                    <div class="absolute top-4 right-4 z-50">
                        <button onclick="closeReportModal()"
                            class="p-2 rounded-full bg-white/10 hover:bg-white/20 text-gray-400 hover:text-white transition-all"><i
                                data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-white">Generate Landing Report</h3>
                    </div>
                    <div class="mb-4 text-xs text-gray-400">Client: <span class="text-white font-bold"
                            id="reportClientName">--</span> | Product: <span class="text-white font-bold"
                            id="reportProduct">--</span></div>
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="text-xs text-gray-500 uppercase font-bold">Ex-Factory (RMB)</label><input
                                    type="number"
                                    class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1">
                            </div>
                            <div><label class="text-xs text-gray-500 uppercase font-bold">MOQ (Units)</label><input
                                    type="number"
                                    class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1">
                            </div>
                        </div>
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Est. Logistics to India
                                (INR)</label><input type="number"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1">
                        </div>
                        <div class="flex items-center gap-2 mt-1"><input type="checkbox" checked
                                class="w-4 h-4 rounded bg-black border-white/10"><label
                                class="text-xs text-gray-300">Quality Verified (Sample/Video)</label></div>
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Notes</label><textarea
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1 h-16"></textarea>
                        </div>
                        <button onclick="alert('Report Generated & Saved to Sourcing Vault'); closeReportModal()"
                            class="w-full bg-sig-green text-black font-bold py-3 rounded-xl mt-2">Save & Notify
                            Client</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="fbaCalcModal" class="fixed inset-0 z-[120] hidden" role="dialog">
            <div class="fixed inset-0 bg-black/80 backdrop-blur-sm" onclick="closeFbaCalc()"></div>
            <div class="fixed inset-0 flex items-center justify-center p-4">
                <div
                    class="bg-[#1c1c1e] border border-white/10 p-8 rounded-3xl w-full max-w-md animate-pop-in relative">
                    <div class="absolute top-4 right-4 z-50">
                        <button onclick="closeFbaCalc()"
                            class="p-2 rounded-full bg-white/10 hover:bg-white/20 text-gray-400 hover:text-white transition-all"><i
                                data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-white">FBA Profit Analyzer</h3>
                    </div>
                    <div class="space-y-3">
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Selling Price ($)</label><input
                                type="number" id="fbaPrice"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white"></div>
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Landed Cost ($)</label><input
                                type="number" id="fbaCost"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white"></div>
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="text-xs text-gray-500 uppercase font-bold">FBA Fees ($)</label><input
                                    type="number" id="fbaFees" value="5.00"
                                    class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white">
                            </div>
                            <div><label class="text-xs text-gray-500 uppercase font-bold">PPC ($/unit)</label><input
                                    type="number" id="fbaPpc" value="3.00"
                                    class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white">
                            </div>
                        </div>
                        <button onclick="calcFbaProfit()"
                            class="w-full bg-sig-gold text-black font-bold py-3 rounded-xl mt-2">Calculate Net
                            Margin</button>
                        <div id="fbaResult"
                            class="hidden mt-4 p-4 bg-white/5 rounded-xl border border-white/5 text-center">
                            <div class="text-xs text-gray-400 uppercase">Net Profit / Unit</div>
                            <div class="text-2xl font-bold text-sig-green font-mono" id="fbaNet">$0.00</div>
                            <div class="text-xs text-gray-500 mt-1" id="fbaRoi">ROI: 0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="calcModal" class="fixed inset-0 z-[110] hidden" role="dialog">
            <div class="fixed inset-0 bg-black/80 backdrop-blur-sm" onclick="closeCalc()"></div>
            <div class="fixed inset-0 flex items-center justify-center p-4">
                <div
                    class="bg-[#1c1c1e] border border-white/10 p-8 rounded-3xl w-full max-w-md animate-pop-in relative">
                    <div class="absolute top-4 right-4 z-50">
                        <button onclick="closeCalc()"
                            class="p-2 rounded-full bg-white/10 hover:bg-white/20 text-gray-400 hover:text-white transition-all"><i
                                data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-white">Landed Cost Estimator</h3>
                    </div>
                    <div class="space-y-4">
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Product Cost (INR)</label><input
                                type="number" id="lcCost"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1">
                        </div>
                        <div><label class="text-xs text-gray-500 uppercase font-bold">Shipping (INR)</label><input
                                type="number" id="lcShip"
                                class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="text-xs text-gray-500 uppercase font-bold">Customs %</label><input
                                    type="number" id="lcDuty" value="10"
                                    class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1">
                            </div>
                            <div><label class="text-xs text-gray-500 uppercase font-bold">GST %</label><input
                                    type="number" id="lcGst" value="18"
                                    class="w-full bg-black/40 border border-white/10 rounded-xl py-2 px-3 text-white mt-1">
                            </div>
                        </div>
                        <button onclick="calcLanded()"
                            class="w-full bg-orange-500 text-white font-bold py-3 rounded-xl mt-4">Calculate</button>
                        <div id="lcResult"
                            class="hidden mt-4 p-4 bg-white/5 rounded-xl border border-white/5 text-center">
                            <div class="text-xs text-gray-400 uppercase">Final Doorstep Price</div>
                            <div class="text-2xl font-bold text-white font-mono" id="lcTotal">₹0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="leadModal" class="fixed inset-0 z-[100] hidden" aria-labelledby="modal-title" role="dialog"
            aria-modal="true">
            <div class="fixed inset-0 bg-black/60 backdrop-blur-md transition-opacity duration-300"
                onclick="closeModal()">
            </div>
            <div class="fixed inset-0 z-10 overflow-y-auto">
                <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                    <div
                        class="relative transform overflow-hidden rounded-3xl bg-[#1c1c1e] border border-white/10 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-4xl animate-pop-in flex flex-col md:flex-row">

                        <button onclick="closeModal()"
                            class="absolute top-4 right-4 z-50 p-2 rounded-full bg-white/10 hover:bg-white/20 text-gray-400 hover:text-white transition-all"><i
                                data-lucide="x" class="w-5 h-5"></i></button>

                        <div class="flex-1 p-8">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h3 class="text-2xl font-bold text-white tracking-tight" id="modalName">Name</h3>
                                    <div id="modalPathBadge" class="mt-2"></div>
                                </div>
                            </div>

                            <div id="sourcingTimeline"
                                class="hidden mb-6 bg-white/5 p-4 rounded-xl border border-white/5">
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="text-[10px] font-bold text-gray-500 uppercase">Sourcing Progress</h4>
                                    <select id="statusUpdater" onchange="updateLeadStage(this.value)"
                                        class="bg-black text-xs text-white border border-white/20 rounded px-2 py-1 focus:outline-none focus:border-sig-green">
                                        <option value="0">Inquiry</option>
                                        <option value="1">Fee Payment</option>
                                        <option value="2">Factory Search</option>
                                        <option value="3">Report Ready</option>
                                        <option value="4">Client Review</option>
                                        <option value="5">Deal Finalized</option>
                                        <option value="6">Shipping</option>
                                        <option value="7">Done</option>
                                    </select>
                                </div>
                                <div class="relative px-2">
                                    <div class="timeline-track">
                                        <div class="timeline-fill" id="timelineFill" style="width: 0%"></div>
                                        <div class="timeline-dot" id="dot0" style="left: 0%"></div>
                                        <div class="timeline-dot" id="dot1" style="left: 14.28%"></div>
                                        <div class="timeline-dot" id="dot2" style="left: 28.57%"></div>
                                        <div class="timeline-dot" id="dot3" style="left: 42.85%"></div>
                                        <div class="timeline-dot" id="dot4" style="left: 57.14%"></div>
                                        <div class="timeline-dot" id="dot5" style="left: 71.42%"></div>
                                        <div class="timeline-dot" id="dot6" style="left: 85.71%"></div>
                                        <div class="timeline-dot" id="dot7" style="left: 100%"></div>
                                    </div>
                                    <div
                                        class="flex justify-between text-[8px] sm:text-[10px] text-gray-500 mt-2 font-mono w-full">
                                        <span>Inquiry</span><span>Fee</span><span>Factory</span><span>Report</span><span>Review</span><span>Deal</span><span>Ship</span><span>Done</span>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-4 gap-4 mb-6">
                                <div class="bg-white/5 p-4 rounded-2xl border border-white/5"><span
                                        class="text-[10px] text-sig-mute uppercase font-bold tracking-wider">Capital</span>
                                    <div class="text-lg font-mono font-bold text-white mt-1" id="modalBudget">--</div>
                                </div>
                                <div class="bg-white/5 p-4 rounded-2xl border border-white/5"><span
                                        class="text-[10px] text-sig-mute uppercase font-bold tracking-wider">Bot
                                        Score</span>
                                    <div class="text-lg font-bold text-sig-green mt-1" id="modalScore">--</div>
                                </div>
                                <div class="bg-white/5 p-4 rounded-2xl border border-white/5"><span
                                        class="text-[10px] text-sig-mute uppercase font-bold tracking-wider">Contact</span>
                                    <div class="text-lg font-mono font-bold text-white mt-1" id="modalPhone">--</div>
                                </div>
                                <div class="bg-white/5 p-4 rounded-2xl border border-white/5"><span
                                        class="text-[10px] text-sig-mute uppercase font-bold tracking-wider">Instagram</span>
                                    <div class="text-sm font-bold text-white mt-2 truncate" id="modalInsta">--</div>
                                </div>
                            </div>
                            <div class="mb-4">
                                <h4 class="text-xs font-bold text-sig-mute uppercase tracking-wider mb-3">AI Context
                                </h4>
                                <div class="p-4 bg-black/40 rounded-2xl border border-white/5 text-sm text-gray-300 italic leading-relaxed"
                                    id="modalTranscript">Transcript...</div>
                            </div>
                        </div>

                        <div
                            class="w-full md:w-80 bg-black/20 border-l border-white/5 p-8 flex flex-col justify-between">

                            <div id="membershipActions" class="hidden">
                                <h4 class="text-xs font-bold text-gray-500 uppercase mb-4 tracking-wider">Membership
                                    Actions
                                </h4>
                                <div class="space-y-3">
                                    <button onclick="alert('Status Updated: Pending Fee')"
                                        class="w-full flex items-center gap-3 px-4 py-3 rounded-xl border border-orange-500/20 bg-orange-500/10 text-orange-400 hover:bg-orange-500/20 transition-all">
                                        <i data-lucide="clock" class="w-5 h-5"></i>
                                        <span class="font-bold text-sm">Mark Pending Fee</span>
                                    </button>
                                    <button onclick="alert('Status Updated: Enrolled')"
                                        class="w-full flex items-center gap-3 px-4 py-3 rounded-xl border border-sig-green/20 bg-sig-green/10 text-sig-green hover:bg-sig-green/20 transition-all">
                                        <i data-lucide="check-circle" class="w-5 h-5"></i>
                                        <span class="font-bold text-sm">Confirm Enrollment</span>
                                    </button>
                                </div>
                            </div>

                            <div class="mt-auto">
                                <div id="dynamicScripts" class="space-y-3 mb-4"></div>
                                <button onclick="window.open('https://wa.me/918828888664', '_blank')"
                                    class="w-full bg-sig-green hover:bg-green-500 text-black font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all mb-3"><i
                                        data-lucide="message-circle" class="w-4 h-4"></i> Open WhatsApp</button>
                                <button onclick="deleteLead(currentLeadId)"
                                    class="w-full bg-sig-red/20 hover:bg-sig-red/30 text-sig-red border border-sig-red/30 font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all"><i
                                        data-lucide="trash-2" class="w-4 h-4"></i> Delete Lead</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // API Configuration
            const API_BASE_URL = window.location.origin;

            // Leads array - populated from API
            let leads = [];

            // Connection status
            let isConnected = false;

            // Check backend connection and load leads
            async function initializeData() {
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');

                try {
                    // Check health endpoint
                    const healthRes = await fetch(`${API_BASE_URL}/api/health`);
                    if (healthRes.ok) {
                        isConnected = true;
                        statusDot.classList.remove('bg-gray-500', 'bg-sig-red');
                        statusDot.classList.add('bg-sig-green', 'animate-pulse');
                        statusText.innerText = 'Connected';
                        statusText.classList.remove('text-sig-red');
                        statusText.classList.add('text-sig-green');

                        // Load leads from API
                        await loadLeads();
                    } else {
                        throw new Error('Backend not responding');
                    }
                } catch (error) {
                    console.error('Connection error:', error);
                    isConnected = false;
                    statusDot.classList.remove('bg-gray-500', 'bg-sig-green', 'animate-pulse');
                    statusDot.classList.add('bg-sig-red');
                    statusText.innerText = 'Offline';
                    statusText.classList.remove('text-sig-green');
                    statusText.classList.add('text-sig-red');
                    // Use empty leads array
                    leads = [];
                    renderLeads();
                }
            }

            // Load leads from API
            async function loadLeads() {
                try {
                    const res = await fetch(`${API_BASE_URL}/api/leads`);
                    if (res.ok) {
                        const data = await res.json();
                        leads = (data.leads || []).map(lead => ({
                            id: lead.id,
                            name: lead.name || 'Unknown',
                            location: lead.location || '--',
                            niche: lead.niche || lead.interest || 'General',
                            budget: lead.budget || 0,
                            path: lead.path || 'Path E',
                            status: lead.status || 'New',
                            transcript: lead.ai_context || '',
                            gender: lead.gender || 'Male',
                            age: lead.age || 25,
                            occupation: lead.occupation || 'Business',
                            interest: lead.interest || 'General',
                            phone: lead.phone || '',
                            instagram: lead.instagram_handle || '',
                            stage: 0
                        }));
                    } else {
                        leads = [];
                    }
                    renderLeads();
                    loadDemographics(); // Load demographics after leads
                } catch (error) {
                    console.error('Error loading leads:', error);
                    leads = [];
                    renderLeads();
                }
            }

            // === DEMOGRAPHICS LOGIC ===
            async function loadDemographics() {
                try {
                    // Fetch live demographics from backend
                    const res = await fetch(`${API_BASE_URL}/api/demographics`);
                    if (!res.ok) throw new Error("Failed to load demographics");
                    const data = await res.json();

                    // 1. Render Age
                    const ageList = document.getElementById('demoAgeList');
                    if (data.age.length > 0) {
                        ageList.innerHTML = data.age.map(item => `
                        <div>
                            <div class="flex justify-between text-xs text-gray-400 mb-1"><span>${item.bracket}</span><span class="text-white">${item.percentage}%</span></div>
                            <div class="bar-container">
                                <div class="bar-fill bg-sig-green w-[${item.percentage}%]"></div>
                            </div>
                        </div>
                    `).join('');
                    } else {
                        ageList.innerHTML = '<div class="text-center text-gray-500 py-4 text-xs italic">No data available</div>';
                    }

                    // 2. Render Gender
                    // Update Donut
                    const maleData = data.gender.find(g => g.type === 'Male') || { percentage: 0 };
                    const femaleData = data.gender.find(g => g.type === 'Female') || { percentage: 0 };

                    // Set CSS dasharray for simple donut (0 100 is empty, 100 0 is full)
                    // circumference is ~100
                    const percent = maleData.percentage;
                    const donutSegment = document.getElementById('genderDonutSegment');
                    if (donutSegment) {
                        donutSegment.setAttribute('stroke-dasharray', `${percent} ${100 - percent}`);
                    }
                    document.getElementById('genderMainPercent').innerText = `${percent}%`;

                    // Update Legend
                    const genderLegend = document.getElementById('genderLegend');
                    if (data.gender.length > 0) {
                        genderLegend.innerHTML = data.gender.map(g => `
                        <div class="flex items-center gap-2 text-xs text-gray-400">
                            <div class="w-2 h-2 ${g.type === 'Male' ? 'bg-blue-500' : 'bg-red-500'} rounded-full"></div> ${g.type} (${g.percentage}%)
                        </div>
                     `).join('');
                    } else {
                        genderLegend.innerHTML = '<div class="text-xs text-gray-500">No data</div>';
                    }

                    // 3. Render Occupation
                    const occList = document.getElementById('demoOccList');
                    if (data.occupation.length > 0) {
                        occList.innerHTML = data.occupation.map(item => `
                        <div>
                            <div class="flex justify-between text-xs text-gray-400 mb-1"><span>${item.type}</span><span class="text-white">${item.percentage}%</span></div>
                            <div class="bar-container">
                                <div class="bar-fill bg-purple-500 w-[${item.percentage}%]"></div>
                            </div>
                        </div>
                    `).join('');
                    } else {
                        occList.innerHTML = '<div class="text-center text-gray-500 py-4 text-xs italic">No data available</div>';
                    }

                    // 4. Render Locations
                    const locGrid = document.getElementById('demoLocationGrid');
                    if (data.locations.length > 0) {
                        locGrid.innerHTML = data.locations.map(item => `
                     <div class="glass-panel p-5 rounded-2xl md:col-span-1 border-white/5">
                        <div class="text-[10px] text-gray-400 uppercase font-bold mb-4 tracking-widest flex items-center gap-2">
                           <i data-lucide="map-pin" class="w-3 h-3"></i> ${item.location}
                        </div>
                         <div class="text-2xl font-bold text-white">${item.count}</div>
                         <div class="text-[10px] text-sig-mute">Active Users</div>
                    </div>
                    `).join('');
                    } else {
                        locGrid.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8 text-sm italic">No location data mapped yet</div>';
                    }

                } catch (err) {
                    console.error("Demographics Load Error", err);
                }
            }

            async function resetData() {
                if (!confirm("⚠️ ARE YOU SURE? \n\nThis will DELETE ALL LEADS permanently. This action cannot be undone.")) return;

                try {
                    const res = await fetch(`${API_BASE_URL}/api/leads/reset`, { method: 'DELETE' });
                    const data = await res.json();
                    if (res.ok) {
                        alert("System Reset Complete. Refreshing...");
                        window.location.reload();
                    } else {
                        alert("Error: " + data.error);
                    }
                } catch (err) {
                    console.error("Reset Error", err);
                    alert("Failed to connect to backend for reset.");
                }
            }


            // Refresh leads periodically (every 30 seconds)
            function startAutoRefresh() {
                setInterval(() => {
                    if (isConnected) {
                        loadLeads();
                    }
                }, 30000);
            }

            // === 1. MAIN DASHBOARD RENDER ===
            function renderLeads(filter = 'all') {
                const container = document.getElementById('leadsList');
                if (!container) return;
                container.innerHTML = '';

                leads.forEach(lead => {
                    let shouldRender = false;
                    // Updated Dashboard Filters
                    if (filter === 'all') shouldRender = true;
                    else if (filter === 'VIP') shouldRender = (lead.budget >= 800000);
                    else if (filter === 'HighIntent') shouldRender = (lead.path === 'Path B' || lead.path === 'Path A');
                    else if (filter === 'LowBudget') shouldRender = (lead.budget > 0 && lead.budget < 300000);

                    if (!shouldRender) return;

                    const score = lead.budget > 800000 ? 9.5 : 7.2;
                    const scoreClass = score > 8 ? 'text-sig-gold' : 'text-sig-green';
                    const pathColors = { "Path A": "text-white bg-white/10", "Path B": "text-black bg-sig-gold", "Path C": "text-blue-400 bg-blue-500/20", "Path D": "text-purple-400 bg-purple-500/20", "Path E": "text-gray-400 bg-white/5" };

                    const row = document.createElement('div');
                    row.className = "grid grid-cols-12 px-6 py-4 items-center apple-table-row cursor-pointer";
                    row.onclick = () => openModal(lead);
                    row.innerHTML = `
                    <div class="col-span-4 flex items-center gap-4">
                        <div class="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center font-bold text-xs text-gray-300">${lead.name.substring(0, 2)}</div>
                        <div><div class="font-medium text-white text-sm">${lead.name}</div><div class="text-[10px] text-sig-mute">${lead.location} • ${lead.niche}</div></div>
                    </div>
                    <div class="col-span-2"><span class="px-2 py-1 rounded text-[10px] font-bold ${pathColors[lead.path]} border border-white/5">${lead.path}</span></div>
                    <div class="col-span-2 text-center font-bold ${scoreClass}">${score}</div>
                    <div class="col-span-2 text-right font-mono text-xs text-sig-mute">₹${(lead.budget / 1000).toFixed(0)}k</div>
                    <div class="col-span-2 text-right"><i data-lucide="chevron-right" class="w-4 h-4 text-gray-600 inline-block"></i></div>
                `;
                    container.appendChild(row);
                });
                lucide.createIcons();
            }

            // === 2. ADD LEAD FUNCTIONALITY ===
            function openAddLeadModal() { document.getElementById('addLeadModal').classList.remove('hidden'); }
            function closeAddLeadModal() { document.getElementById('addLeadModal').classList.add('hidden'); }

            function saveNewLead() {
                const name = document.getElementById('newLeadName').value;
                const loc = document.getElementById('newLeadLoc').value;
                const phone = document.getElementById('newLeadPhone').value;
                const bud = parseInt(document.getElementById('newLeadBudget').value) || 0;
                const path = document.getElementById('newLeadPath').value;
                const niche = document.getElementById('newLeadNiche').value;

                if (name && loc) {
                    const newLead = {
                        id: leads.length + 1,
                        name: name,
                        location: loc,
                        phone: phone,
                        niche: niche,
                        budget: bud,
                        path: path,
                        transcript: "Manual Entry",
                        gender: "Male",
                        age: 25,
                        occupation: "Business"
                    };
                    leads.unshift(newLead);
                    renderLeads();
                    closeAddLeadModal();
                    alert("Lead Added Successfully");
                }
            }

            // === SUB-PAGE RENDERERS ===
            function renderTradingLeads(filterVal) {
                const list = document.getElementById('tradingLeadsList');
                if (!list) return;
                list.innerHTML = '';

                document.querySelectorAll('.trading-filter-btn').forEach(btn => {
                    if (btn.innerText.includes(filterVal) || (filterVal === 'Mentorship' && btn.innerText.includes('VIP'))) {
                        btn.classList.add('bg-white/20', 'text-white', 'border-transparent');
                        btn.classList.remove('bg-black', 'text-gray-400', 'border-white/10');
                    } else {
                        btn.classList.remove('bg-white/20', 'text-white', 'border-transparent');
                        btn.classList.add('bg-black', 'text-gray-400', 'border-white/10');
                    }
                });

                leads.filter(l => l.path === 'Path C').forEach(lead => {
                    let match = false;
                    if (filterVal === 'All') match = true;
                    else if (filterVal === 'Mentorship' && lead.interest === 'Mentorship') match = true;
                    else if (filterVal === 'Guidebook' && lead.interest === 'Guidebook') match = true;
                    else if (filterVal === 'General' && lead.interest === 'General') match = true;
                    else if (filterVal === 'Students' && lead.status === 'Enrolled') match = true; // NEW FILTER LOGIC

                    if (!match) return;

                    let badgeColor = 'text-gray-400 bg-white/5';
                    let badgeText = lead.interest || 'General';

                    if (lead.status === 'Enrolled') {
                        badgeColor = 'text-sig-green bg-sig-green/10 border-sig-green/20';
                        badgeText = 'Student'; // Override text if enrolled
                    } else {
                        if (lead.interest === 'Mentorship') badgeColor = 'text-sig-gold bg-sig-gold/10 border-sig-gold/20';
                        if (lead.interest === 'Guidebook') badgeColor = 'text-blue-400 bg-blue-500/10 border-blue-500/20';
                    }

                    const row = document.createElement('div');
                    row.className = "grid grid-cols-12 px-6 py-4 items-center apple-table-row cursor-pointer";
                    row.onclick = () => openModal(lead);
                    row.innerHTML = `
                    <div class="col-span-4 flex items-center gap-4">
                        <div class="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center font-bold text-xs text-gray-300">${lead.name.substring(0, 2)}</div>
                        <div><div class="font-medium text-white text-sm">${lead.name}</div><div class="text-[10px] text-sig-mute">${lead.location}</div></div>
                    </div>
                    <div class="col-span-3"><span class="px-2 py-1 rounded text-[10px] font-bold border ${badgeColor}">${badgeText}</span></div>
                    <div class="col-span-2 text-xs text-gray-400">Beginner</div>
                    <div class="col-span-3 text-right"><button class="px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-xs font-medium text-white transition-all">View Profile</button></div>
                `;
                    list.appendChild(row);
                });
            }

            function renderFbaLeads(filterVal) {
                const list = document.getElementById('fbaLeadsList');
                if (!list) return;
                list.innerHTML = '';

                document.querySelectorAll('.fba-filter-btn').forEach(btn => {
                    if (btn.innerText.includes(filterVal) || (filterVal === 'VIP' && btn.innerText.includes('VIP'))) {
                        btn.classList.add('bg-white/20', 'text-white', 'border-transparent');
                        btn.classList.remove('bg-black', 'text-gray-400', 'border-white/10');
                    } else {
                        btn.classList.remove('bg-white/20', 'text-white', 'border-transparent');
                        btn.classList.add('bg-black', 'text-gray-400', 'border-white/10');
                    }
                });

                leads.filter(l => l.path === 'Path B').forEach(lead => {
                    let match = false;
                    if (filterVal === 'All') match = true;
                    else if (filterVal === 'VIP' && lead.budget >= 800000) match = true;
                    else if (filterVal === 'Enrolled' && lead.status === 'Enrolled') match = true;
                    else if (filterVal === 'LowCap' && lead.budget < 800000 && lead.status !== 'Enrolled') match = true;

                    if (!match) return;

                    let qualBadge = '';
                    if (lead.status === 'Enrolled') qualBadge = '<span class="px-2 py-1 rounded text-[10px] font-bold text-sig-green bg-sig-green/10 border border-sig-green/20">Enrolled Student</span>';
                    else if (lead.budget >= 800000) qualBadge = '<span class="px-2 py-1 rounded text-[10px] font-bold text-sig-gold bg-sig-gold/10 border border-sig-gold/20">Prime Investor</span>';
                    else qualBadge = '<span class="px-2 py-1 rounded text-[10px] font-bold text-red-400 bg-red-500/10 border border-red-500/20">Low Capital</span>';

                    const row = document.createElement('div');
                    row.className = "grid grid-cols-12 px-6 py-4 items-center apple-table-row cursor-pointer";
                    row.onclick = () => openModal(lead);
                    row.innerHTML = `
                    <div class="col-span-4 flex items-center gap-4">
                        <div class="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center font-bold text-xs text-gray-300">${lead.name.substring(0, 2)}</div>
                        <div><div class="font-medium text-white text-sm">${lead.name}</div><div class="text-[10px] text-sig-mute">${lead.location}</div></div>
                    </div>
                    <div class="col-span-3">${qualBadge}</div>
                    <div class="col-span-2 text-right font-mono text-xs text-sig-mute">₹${(lead.budget / 1000).toFixed(0)}k</div>
                    <div class="col-span-3 text-right"><button class="px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-xs font-medium text-white transition-all">View Profile</button></div>
                `;
                    list.appendChild(row);
                });
            }

            // === UTILS ===
            function openFbaCalc() { document.getElementById('fbaCalcModal').classList.remove('hidden'); }
            function closeFbaCalc() { document.getElementById('fbaCalcModal').classList.add('hidden'); }
            function calcFbaProfit() {
                const price = parseFloat(document.getElementById('fbaPrice').value) || 0;
                const cost = parseFloat(document.getElementById('fbaCost').value) || 0;
                const fees = parseFloat(document.getElementById('fbaFees').value) || 0;
                const ppc = parseFloat(document.getElementById('fbaPpc').value) || 0;
                const net = price - cost - fees - ppc - (price * 0.15);
                const roi = (net / (cost + fees + ppc)) * 100;
                document.getElementById('fbaResult').classList.remove('hidden');
                document.getElementById('fbaNet').innerText = "$" + net.toFixed(2);
                document.getElementById('fbaRoi').innerText = "ROI: " + roi.toFixed(1) + "%";
            }

            // === DEMOGRAPHICS DETAILS ===
            let currentDemoType = '';
            function openDemoDetail(type) {
                currentDemoType = type;
                const title = document.getElementById('demoDetailTitle');
                const filters = document.getElementById('demoFilters');

                if (type === 'gender') title.innerText = 'Gender Distribution';
                else if (type === 'age') title.innerText = 'Age Distribution';
                else if (type === 'occupation') title.innerText = 'Occupation Profile';

                let filterButtons = `<button onclick="renderDemoLeads('All')" class="demo-filter-btn px-4 py-1.5 rounded-full bg-white/10 text-xs text-white font-medium hover:bg-white/20 active transition-all">All</button>`;

                if (type === 'gender') ['Male', 'Female'].forEach(f => filterButtons += `<button onclick="renderDemoLeads('${f}')" class="demo-filter-btn px-4 py-1.5 rounded-full bg-black border border-white/10 text-xs text-gray-400 hover:text-white transition-all">${f}</button>`);
                else if (type === 'age') ['18-24', '25-40', '41-55', 'Others'].forEach(f => filterButtons += `<button onclick="renderDemoLeads('${f}')" class="demo-filter-btn px-4 py-1.5 rounded-full bg-black border border-white/10 text-xs text-gray-400 hover:text-white transition-all">${f}</button>`);
                else if (type === 'occupation') ['Salaried', 'Business', 'Student', 'Inv/Ret'].forEach(f => filterButtons += `<button onclick="renderDemoLeads('${f}')" class="demo-filter-btn px-4 py-1.5 rounded-full bg-black border border-white/10 text-xs text-gray-400 hover:text-white transition-all">${f}</button>`);

                filters.innerHTML = filterButtons;
                switchView('demographics-details');
                renderDemoLeads('All');
            }

            function renderDemoLeads(filterVal) {
                const list = document.getElementById('demoLeadsList');
                list.innerHTML = '';
                document.querySelectorAll('.demo-filter-btn').forEach(btn => {
                    if (btn.innerText === filterVal) { btn.classList.add('bg-white/20', 'text-white'); btn.classList.remove('bg-black', 'text-gray-400'); }
                    else { btn.classList.remove('bg-white/20', 'text-white'); btn.classList.add('bg-black', 'text-gray-400'); }
                });

                leads.forEach(lead => {
                    let match = false;
                    if (filterVal === 'All') match = true;
                    else if (currentDemoType === 'gender' && lead.gender === filterVal) match = true;
                    else if (currentDemoType === 'occupation') { if (filterVal === 'Inv/Ret' && lead.occupation === 'Investor') match = true; else if (lead.occupation === filterVal) match = true; }
                    else if (currentDemoType === 'age') {
                        if (filterVal === '18-24' && lead.age >= 18 && lead.age <= 24) match = true;
                        if (filterVal === '25-40' && lead.age >= 25 && lead.age <= 40) match = true;
                        if (filterVal === '41-55' && lead.age >= 41 && lead.age <= 55) match = true;
                        if (filterVal === 'Others' && (lead.age < 18 || lead.age > 55)) match = true;
                    }
                    if (!match) return;

                    const row = document.createElement('div');
                    row.className = "grid grid-cols-12 px-6 py-4 items-center apple-table-row cursor-pointer";
                    row.onclick = () => openModal(lead);

                    let occColor = 'text-gray-400';
                    if (lead.occupation === 'Business') occColor = 'text-sig-gold';
                    if (lead.occupation === 'Salaried') occColor = 'text-sig-purple';
                    if (lead.occupation === 'Student') occColor = 'text-blue-400';

                    row.innerHTML = `
                    <div class="col-span-4 flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center font-bold text-xs text-gray-300">${lead.name.substring(0, 2)}</div><div><div class="font-medium text-white text-sm">${lead.name}</div><div class="text-[10px] text-sig-mute">${lead.location}</div></div></div>
                    <div class="col-span-2 text-sm text-gray-400">${lead.gender}</div>
                    <div class="col-span-2 text-sm text-gray-400">${lead.age}</div>
                    <div class="col-span-2 text-xs font-bold uppercase tracking-wider ${occColor}">${lead.occupation}</div>
                    <div class="col-span-2 text-right font-mono text-xs text-sig-mute">₹${(lead.budget / 1000).toFixed(0)}k</div>
                `;
                    list.appendChild(row);
                });
            }

            // === TIMELINE LOGIC ===
            let currentLeadId = null;

            function updateLeadStage(newStage) {
                const lead = leads.find(l => l.id === currentLeadId);
                if (lead) {
                    lead.stage = parseInt(newStage);
                    updateTimelineVisuals(lead.stage);
                }
            }

            function updateTimelineVisuals(stageIndex) {
                const width = (stageIndex / 7) * 100;
                document.getElementById('timelineFill').style.width = width + "%";
                for (let i = 0; i < 8; i++) {
                    const dot = document.getElementById('dot' + i);
                    if (i <= stageIndex) dot.classList.add('active');
                    else dot.classList.remove('active');
                }
            }

            function openModal(lead) {
                currentLeadId = lead.id;
                document.getElementById('leadModal').classList.remove('hidden');
                document.getElementById('modalName').innerText = lead.name;
                document.getElementById('modalBudget').innerText = "₹" + lead.budget.toLocaleString();
                document.getElementById('modalTranscript').innerText = lead.transcript;
                document.getElementById('modalPhone').innerText = lead.phone || "--";
                document.getElementById('modalInsta').innerText = lead.instagram ? "@" + lead.instagram : "--";

                // Logic for Membership Actions
                const membershipActions = document.getElementById('membershipActions');
                const timeline = document.getElementById('sourcingTimeline');
                // KEY FIX: DETECT IF ON DASHBOARD
                const isDashboard = document.getElementById('view-dashboard').classList.contains('active');

                if (lead.path === "Path A") {
                    timeline.classList.remove('hidden');
                    membershipActions.classList.add('hidden'); // Hide B/C actions
                    // Render Timeline Status
                    const stage = lead.stage || 0;
                    document.getElementById('statusUpdater').value = stage;
                    updateTimelineVisuals(stage);
                } else if ((lead.path === "Path B" || lead.path === "Path C") && !isDashboard) { // ONLY SHOW IF NOT DASHBOARD
                    timeline.classList.add('hidden');
                    membershipActions.classList.remove('hidden'); // Show B/C actions
                } else {
                    timeline.classList.add('hidden');
                    membershipActions.classList.add('hidden');
                }

                // Re-render Dynamic Scripts (Currently Empty as Quick Actions were removed)
                const scriptContainer = document.getElementById('dynamicScripts');
                scriptContainer.innerHTML = '';
            }

            function closeModal() { document.getElementById('leadModal').classList.add('hidden'); }

            // Delete a lead by ID
            async function deleteLead(leadId) {
                if (!confirm("⚠️ Delete this lead?\n\nThis will permanently remove this lead and all associated data.")) return;

                try {
                    const res = await fetch(`${API_BASE_URL}/api/leads/${leadId}`, { method: 'DELETE' });
                    const data = await res.json();
                    if (res.ok) {
                        closeModal();
                        // Remove from local array
                        leads = leads.filter(l => l.id !== leadId);
                        renderLeads();
                        loadDemographics();
                        alert("Lead deleted successfully.");
                    } else {
                        alert("Error: " + (data.error || 'Failed to delete'));
                    }
                } catch (err) {
                    console.error("Delete Error", err);
                    alert("Failed to connect to backend.");
                }
            }

            // === UTILS ===
            function openCalculator() { document.getElementById('calcModal').classList.remove('hidden'); }
            function closeCalc() { document.getElementById('calcModal').classList.add('hidden'); }

            function calcLanded() {
                const cost = parseFloat(document.getElementById('lcCost').value) || 0;
                const ship = parseFloat(document.getElementById('lcShip').value) || 0;
                const duty = parseFloat(document.getElementById('lcDuty').value) || 0;
                const gst = parseFloat(document.getElementById('lcGst').value) || 0;

                const subtotal = cost + ship;
                const withDuty = subtotal + (subtotal * (duty / 100)); // subtotal + customs
                const total = withDuty + (withDuty * (gst / 100)); // (subtotal + customs) + gst

                document.getElementById('lcResult').classList.remove('hidden');
                document.getElementById('lcTotal').innerText = "₹" + Math.round(total).toLocaleString();
            }
            function openInquiryModal() { document.getElementById('inquiryModal').classList.remove('hidden'); }
            function closeInquiryModal() { document.getElementById('inquiryModal').classList.add('hidden'); }
            function openReportModal(client, product) {
                document.getElementById('reportClientName').innerText = client;
                document.getElementById('reportProduct').innerText = product;
                document.getElementById('reportModal').classList.remove('hidden');
            }
            function closeReportModal() { document.getElementById('reportModal').classList.add('hidden'); }

            // === FIXED EXPORT DATA FUNCTION ===
            function exportData() {
                // Trigger download from backend to get ALL leads, not just visible ones
                window.location.href = `${API_BASE_URL}/api/export/leads.csv`;
            }

            // === HUDOOD LOGIC ===
            async function renderHudoodLeads() {
                const list = document.getElementById('hudoodList');
                if (!list) return;
                list.innerHTML = '';

                try {
                    // Fetch from API if connected
                    if (isConnected) {
                        const res = await fetch(`${API_BASE_URL}/api/hudood/queries`);
                        if (res.ok) {
                            const data = await res.json();
                            const queries = data.queries || [];

                            if (queries.length === 0) {
                                list.innerHTML = '<div class="text-center text-gray-500 py-8 text-sm italic">No Hudood queries logged yet</div>';
                                return;
                            }

                            queries.forEach(q => {
                                let statusBadge = q.status === 'Redirected' ? '<span class="px-2 py-1 rounded text-[10px] font-bold text-sig-green bg-sig-green/10 border border-sig-green/20">Redirected</span>' : '<span class="px-2 py-1 rounded text-[10px] font-bold text-orange-400 bg-orange-500/10 border border-orange-500/20">Pending</span>';
                                const row = document.createElement('div');
                                row.className = "grid grid-cols-12 px-6 py-4 items-center apple-table-row hover:bg-white/5 transition-colors";
                                row.innerHTML = `<div class="col-span-4"><div class="font-bold text-white text-sm">${q.name}</div><div class="text-xs text-gray-500">"${q.query}"</div></div><div class="col-span-3 text-xs text-gray-300">${q.topic}</div><div class="col-span-3">${statusBadge}</div><div class="col-span-2 text-right"></div>`;
                                list.appendChild(row);
                            });
                            return;
                        }
                    }
                } catch (err) {
                    console.error("Hudood Load Error", err);
                }

                // Fallback: Empty state
                list.innerHTML = '<div class="text-center text-gray-500 py-8 text-sm italic">No Hudood queries logged yet</div>';
            }

            // === VIEW SWITCHER ===
            function switchView(viewName) {
                document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
                document.getElementById(`view-${viewName}`).classList.add('active');
                document.querySelectorAll('aside nav button').forEach(btn => {
                    btn.classList.remove('bg-white/10', 'text-white', 'shadow-inner');
                    if (!btn.classList.contains('text-gray-400')) btn.classList.add('text-gray-400');
                });
                const activeBtn = document.getElementById(`nav-${viewName}`);
                if (activeBtn) {
                    activeBtn.classList.add('bg-white/10', 'text-white', 'shadow-inner');
                    activeBtn.classList.remove('text-gray-400');
                }
                if (viewName === 'trading') renderTradingLeads('All');
                if (viewName === 'fba') renderFbaLeads('All');
                if (viewName === 'dashboard') renderLeads('all');
                if (viewName === 'hudood') renderHudoodLeads();
            }

            function filterTable(filterName, btn) {
                renderLeads(filterName);
                document.querySelectorAll('.filter-btn').forEach(b => { b.classList.remove('active'); b.classList.replace('text-white', 'text-gray-400'); });
                btn.classList.add('active'); btn.classList.replace('text-gray-400', 'text-white');
            }
            function toggleMobileMenu() {
                const menu = document.getElementById('mobileMenu');
                menu.classList.toggle('hidden'); menu.classList.toggle('flex');
            }

            // === LOGIN SYSTEM ===
            const ADMIN_EMAIL = 'shariahinvestmentsindia@gmail.com';
            const ADMIN_PASSWORD = 'Pa$$w0rd8864';

            function handleLogin(event) {
                event.preventDefault();
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;
                const errorEl = document.getElementById('loginError');

                if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                    // Store session
                    sessionStorage.setItem('sig_authenticated', 'true');
                    // Hide login, show app
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    document.getElementById('mainApp').classList.add('flex');
                    // Initialize
                    initializeData();
                    startAutoRefresh();
                    lucide.createIcons();
                } else {
                    errorEl.classList.remove('hidden');
                    document.getElementById('loginPassword').value = '';
                }
            }

            function checkAuth() {
                if (sessionStorage.getItem('sig_authenticated') === 'true') {
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    document.getElementById('mainApp').classList.add('flex');
                    initializeData();
                    startAutoRefresh();
                    lucide.createIcons();
                }
            }

            window.addEventListener('DOMContentLoaded', () => {
                checkAuth();
                lucide.createIcons(); // For login screen icons too
            });
        </script>
    </div>
</body>

</html>